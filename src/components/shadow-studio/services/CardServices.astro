---
interface Props {
  title: string;
  description: string;
  icon: string;
  link: string;
  index: number;
}

const { title, description, icon, link, index } = Astro.props;
---

<div
  class="service-reveal spotlight-card group relative flex flex-col justify-between p-8 h-full bg-secondarybg rounded-2xl border border-white/5 overflow-hidden
         opacity-0 translate-y-8
         transition-all duration-1000 ease-out
         hover:-translate-y-3 hover:shadow-2xl hover:shadow-black/60 hover:border-secondary/50"
  data-index={index}
  style={`transition-delay: ${index * 200}ms`}
>
  <div
    class="pointer-events-none absolute -inset-px opacity-0 transition duration-300 group-hover:opacity-100 z-0"
    style="background: radial-gradient(500px circle at var(--x) var(--y), rgba(255, 255, 255, 0.07), transparent 40%);"
  >
  </div>

  <div
    class="absolute inset-0 bg-gradient-to-br from-primary/5 via-transparent to-transparent group-hover:opacity-100 transition-opacity duration-700 pointer-events-none z-0"
  >
  </div>

  <div class="relative z-10">
    <div
      class="relative w-12 h-12 mb-8
             opacity-0 scale-50
             group-[.reveal-active]:opacity-100 group-[.reveal-active]:scale-100
             transition-all duration-700 delay-200 ease-[cubic-bezier(0.34,1.56,0.64,1)]"
    >
      <div
        class="absolute inset-0 bg-primary/20 blur-xl rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-300"
      >
      </div>
      <div
        class="relative w-full h-full text-zinc-500 group-hover:text-primary transition-all duration-300 group-hover:scale-110 group-hover:-rotate-6 origin-center"
      >
        <svg
          class="w-full h-full"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1"
          stroke="currentColor"
        >
          <use href={`/shadow-studio-Sprite.svg#${icon}`}></use>
        </svg>
      </div>
    </div>

    <h3
      class="text-xl font-aurora-title font-medium text-white uppercase tracking-widest mb-4
             opacity-0 translate-y-4
             group-[.reveal-active]:opacity-100 group-[.reveal-active]:translate-y-0
             transition-all duration-700 delay-300 ease-out
             group-hover:text-primary/90"
    >
      {title}
    </h3>

    <p
      class="text-sm font-aurora-body text-zinc-500 font-light leading-relaxed
             opacity-0
             group-[.reveal-active]:opacity-100
             transition-all duration-1000 delay-500
             group-hover:text-zinc-200"
    >
      {description}
    </p>
  </div>

  <div
    class="relative z-10 mt-10 pt-6 border-t border-white/5 group-hover:border-white/10
           opacity-0 translate-y-4
           group-[.reveal-active]:opacity-100 group-[.reveal-active]:translate-y-0
           transition-all duration-700 delay-500 ease-out"
  >
    <a
      href={link}
      class="flex items-center justify-between w-full h-full group/btn"
    >
      <span
        class="text-[10px] font-mono font-bold uppercase tracking-[0.25em] text-zinc-500 group-hover/btn:text-white transition-colors duration-300"
      >
        Explorar
      </span>

      <div
        class="relative flex items-center justify-center w-8 h-8 rounded-full border border-zinc-700 text-zinc-500
               transition-all duration-300 ease-out
               group-hover/btn:border-primary group-hover/btn:bg-primary group-hover/btn:text-white group-hover/btn:scale-110"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
          class="w-3.5 h-3.5 transform transition-transform duration-300 group-hover/btn:-rotate-45"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3"></path>
        </svg>
      </div>
    </a>
  </div>
</div>

<script>
  const cards = document.querySelectorAll(
    ".spotlight-card"
  ) as NodeListOf<HTMLElement>;

  cards.forEach((card) => {
    card.addEventListener("mousemove", (e: MouseEvent) => {
      const rect = card.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      requestAnimationFrame(() => {
        card.style.setProperty("--x", `${x}px`);
        card.style.setProperty("--y", `${y}px`);
      });
    });
  });

  const observerOptions = {
    root: null,
    rootMargin: "0px",
    threshold: 0.4,
  };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        const el = entry.target as HTMLElement;

        el.classList.remove("opacity-0", "translate-y-8");
        el.classList.add("opacity-100", "translate-y-0", "reveal-active");

        setTimeout(() => {
          el.classList.remove(
            "duration-1000",
            "duration-700",
            "delay-200",
            "delay-300",
            "delay-500",
            "delay-700"
          );
          el.classList.add("duration-300");

          const children = el.querySelectorAll(
            ".transition-all, .transition-colors"
          );
          children.forEach((child) => {
            child.classList.remove(
              "duration-1000",
              "duration-700",
              "delay-200",
              "delay-300",
              "delay-500",
              "delay-700"
            );
            child.classList.add("duration-300");
            (child as HTMLElement).style.transitionDelay = "0ms";
          });

          el.style.transitionDelay = "0ms";
        }, 1500);

        observer.unobserve(el);
      }
    });
  }, observerOptions);

  const revealElements = document.querySelectorAll(".service-reveal");
  revealElements.forEach((el) => observer.observe(el));
</script>
