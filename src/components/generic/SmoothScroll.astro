---
interface Props {
  offset?: number;
  duration?: number;
}

const { offset = 0, duration = 1.2 } = Astro.props;
---

<div
  id="lenis-config"
  data-offset={offset}
  data-duration={duration}
  class="hidden"
>
</div>

<script>
  import Lenis from "lenis";

  const configDiv = document.getElementById("lenis-config");
  const offset = Number(configDiv?.dataset.offset || 0);
  const durationProp = Number(configDiv?.dataset.duration || 1.2);

  const lenis = new Lenis({
    duration: durationProp,
    easing: (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t)),
    orientation: "vertical",
    gestureOrientation: "vertical",
    smoothWheel: true,
    touchMultiplier: 2,
  });

  // @ts-ignore
  function raf(time) {
    lenis.raf(time);
    requestAnimationFrame(raf);
  }
  requestAnimationFrame(raf);

  window.addEventListener(
    "click",
    (e) => {
      // @ts-ignore
      const link = e.target.closest("a");
      if (!link) return;

      const href = link.getAttribute("href");
      if (!href || !href.startsWith("#") || href.length < 2) return;

      const target = document.querySelector(href);
      if (!target) return;

      e.preventDefault();
      e.stopImmediatePropagation();

      window.dispatchEvent(new CustomEvent("lenis-scroll-start"));
      lenis.scrollTo(target, {
        offset: offset,
        duration: 2,
        lock: false,
        force: true,
      });
    },
    { capture: true }
  );
</script>
